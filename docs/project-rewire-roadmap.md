# Project Rewire — Feature Roadmap

> 來源：Gemini 對話中的完整遊戲設計討論。已實作的 v0.1 / v0.2 不在此列。
> 本文件為功能收集與規劃用途，各版本開工前再撰寫正式 PRD。


## v0.3：拖拉接線與多迴路

### FR-A：拖拉接線（Drag & Drop Wiring）

v0.2 的線材選擇為點選卡片，缺乏實際「接線」的操作感。

**新增行為：**
- 玩家從線材捲拖曳線段，連接 NFB 到插座
- 拖曳過程中即時顯示 SVG 線段路徑
- 可替換線材，替換時舊線段消失、新線段接上
- 接線完成後才能送電

**設計參考（Gemini 原文）：**
> 「從線材捲拖線出來，接到 NFB 再接到插座。這個拖拉的手感很重要。」

### FR-B：多迴路 / 多 NFB

v0.2 只有單一迴路（1 個 NFB + 1 條線 + 1 組插座），策略空間有限。

**新增行為：**
- 配電箱中可安裝多個 NFB（DIN 軌道上排列）
- 每個 NFB 獨立接線到不同插座群組
- 玩家需決定哪些電器分配到哪個迴路
- 單一迴路過載只跳該迴路的 NFB，不影響其他迴路
- 新增關卡利用多迴路場景（如：廚房專用迴路 + 客廳迴路）

**設計參考（Gemini 原文）：**
> 「每關給一張 house load table，列出各房間的電器與瓦數。玩家要決定怎麼分迴路。」

### FR-C：110V / 220V 電壓區分

目前 220V 電器只是用不同的 V 值計算電流，遊戲畫面與過程中 110V 和 220V 完全沒有差異，玩家感受不到電壓的意義。

**現況問題：**
- 烘衣機 2200W/220V = 10A，看起來跟吹風機 1200W/110V = 10.9A 差不多
- 沒有專用迴路概念，220V 電器跟 110V 共用同一條線、同一個 NFB
- 電路圖上看不出 110V 和 220V 的差別

**改善方向（隨多迴路一起實現）：**
- 220V 電器需接到 220V 專用迴路（紅-黑跨相），不能與 110V 共用
- 電路圖上 220V 迴路用雙線（紅+黑）表示，110V 用單線（紅或黑+白）
- 220V 插座外觀與 110V 不同（T 型 vs 一般）
- NFB 類型區分：110V 用 1P NFB，220V 用 2P NFB
- 若 220V 電器誤接 110V 迴路 → 功率不足、電器無法正常運作（新失敗類型）

**設計參考（使用者回饋）：**
> 「畫面上 110V 跟 220V 的顯示沒有意思，完全沒有感覺跟混合電壓有什麼關聯。」

**備註：** 此功能與 FR-B 多迴路高度相關，建議一起實作。在多迴路之前可先做視覺區分（如電器卡片、電路圖上標示不同顏色），但要真正有意義需要多迴路支撐。

### FR-D：NFB 撥桿互動

目前 NFB 送電為按鈕形式，缺乏儀式感。

**新增行為：**
- NFB 改為可拖曳的撥桿（向上=ON、向下=OFF）
- 送電瞬間加入撥桿動畫與觸覺回饋（音效 + 視覺）
- 跳脫時撥桿自動彈回 OFF 位置

**設計參考（Gemini 原文）：**
> 「扳下 NFB 送電——這是全遊戲最有儀式感的一步。」


## v0.4：相位平衡與漏電保護

### FR-E：單相三線制相位平衡

台灣住宅使用單相三線制（紅/白/黑），玩家需平衡分配迴路到不同相位。

**新增行為：**
- 配電箱 NFB 分為紅相（R-N）與黑相（T-N）
- 玩家分配迴路到紅相或黑相
- 兩相負載不平衡時，中性線（白線）電流增加
- 中性線電流過高會導致電壓降與發熱（WARNING 狀態）
- 新增關卡要求相位平衡（如：冷氣 220V 接紅-黑，其他 110V 分散兩相）

**設計參考（Gemini 原文）：**
> 「相位平衡是進階玩法。紅白接一相、黑白接一相，兩邊負載要平均，不然中性線會過熱。」

### FR-F：ELCB 漏電斷路器

NFB 只保護過載，ELCB 保護漏電（人身安全）。

**新增行為：**
- 新增 ELCB 元件，可安裝在迴路上
- 浴室、廚房等潮濕環境的迴路必須裝 ELCB
- 漏電事件（隨機或特定場景觸發）時，有 ELCB 的迴路安全斷電，沒有的會造成電擊危險
- 成本考量：ELCB 比 NFB 貴

### FR-G：更多電器與線材

**新增電器：**

| 電器 | 功率 | 電壓 | 電流 | 說明 |
|------|------|------|------|------|
| IH 爐 | 3000W | 220V | 13.6A | 廚房大功率，需專用迴路 |
| 冰箱 | 200W | 110V | 1.8A | 低功率持續性負載 |
| 冷氣 | 依噸數 | 220V | 依噸數 | 220V 大型負載 |
| 浴室暖風機 | 1650W | 220V | 7.5A | 潮濕環境，需 ELCB |

**新增線材：**

| 線徑 | 安全電流 | 成本/米 | 說明 |
|------|----------|---------|------|
| 14mm² | 70A | $28 | 總電源入戶線等級 |


## v0.5：整線系統與老屋模式

### FR-H：整線系統與美觀評分

配電箱不只要安全，還要整齊美觀。

**新增行為：**
- 玩家可拖曳箱內電線路徑，整理成直角走線
- 使用束帶工具固定線束
- 演算法計算美觀評分：
  - 電線平行度
  - 交叉數量（越少越好）
  - 束帶使用適當性
- 美觀評分影響關卡星數（安全 + 成本 + 美觀 = 三星評分）

**設計參考（Gemini 原文）：**
> 「整線是一種藝術。把線理成直角、用束帶固定、標籤貼好，打開箱蓋的那一刻就是高潮。」

### FR-I：老屋驚魂模式

打開真實老屋的配電箱，面對各種恐怖接法。

**新增行為：**
- 特殊關卡類型：玩家打開舊配電箱
- 可能遇到的問題：
  - 老鼠尾接法（中性線用膠帶纏在一起，已氧化發黑）
  - 活線直接塞進 NFB 沒壓端子（O 型/Y 型），接觸不良發熱
  - 不同迴路的線混在一起，無法辨識哪條是哪條
  - 超載的舊線（1.6mm² 接 30A NFB）
- 任務：重新整理——切線、壓端子、裝端子台、重新分迴路
- Before/After 視覺對比作為過關獎勵

**設計參考（Gemini 原文）：**
> 「打開舊箱子的那個瞬間，看到一團糾結的電線、膠帶纏的中性線、沒壓端子的活線⋯⋯這就是老屋驚魂。」

### FR-J：壓接端子

線材品質機制，影響接觸電阻與安全性。

**新增行為：**
- 線材末端需壓接端子（O 型環 / Y 型叉）才能安全接入 NFB
- 沒壓端子直接接線 → 接觸電阻高 → 發熱風險
- 壓接小遊戲：選對端子規格、對準、壓實
- 品質影響：壓不好 → 鬆脫風險


## v0.10：工程品質與體驗優化

> 詳見 `docs/project-rewire-prd-v0.10.md`

v0.1–v0.9 功能完備後，聚焦工程品質與使用者體驗的全面提升。

### FR-L-A：Code-splitting（延遲載入）
React.lazy + Suspense 分割非首屏元件，降低初始 JS bundle 至 < 350 KB。

### FR-L-B：GameBoard 重構（Custom Hooks 抽取）
1953 行 GameBoard 拆分為 5 個 custom hooks，元件本體 < 500 行。

### FR-L-C：CSS 模組化
4391 行 App.css 拆分為 per-component CSS Modules。

### FR-L-D：音量控制
靜音 / 音量滑桿 + localStorage 持久化。

### FR-L-E：Error Boundary
React Error Boundary 攔截渲染錯誤，避免白屏。

### FR-L-F：PWA 支援
Service Worker + manifest，離線遊玩、手機安裝。

### FR-L-G：載入畫面
index.html 內聯 loading 畫面，取代白屏等待。

### FR-L-H：Accessibility 深化
ARIA landmarks + 鍵盤操作 + screen reader 支援。


## v1.0：弱電與網路系統

### FR-K：弱電箱整理

**新增行為：**
- 獨立的弱電箱介面（Switch、Router、Patch Panel）
- 理線：整理糾結的網路線
- 剪線 → 壓 RJ45 接頭（記 T-568B 色序小遊戲）
- 插入 Switch 對應 port
- 貼標籤標示每條線的去向
- Fluke 測試報告驗收

### FR-L：訊號品質模擬

**新增行為：**
- 網路線超過 100m 造成訊號衰減（速度下降）
- 強弱電同管或距離太近造成 EMI 干擾（封包遺失）
- 線材選擇：Cat5e / Cat6 / Cat6a（成本 vs 效能）

### FR-M：Wi-Fi 覆蓋規劃

**新增行為：**
- Mesh Wi-Fi 節點配置
- 視覺化 Wi-Fi 訊號覆蓋熱力圖
- 牆壁材質影響訊號穿透力
- 目標：全屋覆蓋達標

### FR-N：光纖熔接

**新增行為：**
- 光纖熔接小遊戲：對準纖芯、熔接、測試損耗
- 光纖到府（FTTH）入戶線施工


## 遠期願景（未排版本）

以下功能來自 Gemini 對話的「完整遊戲願景」，尚未排入具體版本：

- **全室拉線**：從配電箱拉線到各房間，包含物理模擬（線材軟體物理）
- **管徑佔有率**：計算線管能塞幾條線，超過 40% 影響散熱與拉線阻力
- **穿線挑戰**：拉線阻力模擬，90 度彎太多會卡線
  - 暴力拉（高風險斷線）
  - 技巧拉（需雇 NPC 助手）
  - 改走明管（降低業主滿意度）
- **拉線膏 / 穿線條**：工具使用機制
- **三用電表**：驗收時量測電壓
- **熱顯像模式**：檢查線路是否因過載發熱
- **X 光透視模式**：按鍵切換，看牆內管路走向（藍=弱電、紅=強電）
- **隨機老屋生成**：漏水、壁癌、線路雜亂的隨機房屋
- **業主需求系統**：「廚房不能再跳電」「要能用氣炸鍋和微波爐」等任務情境
- **NPC 助手**：雇人幫忙拉線、扶梯等
- **業主滿意度 / 美觀評分**：綜合安全、成本、整潔度的評分系統
- **匯流排（銅排）選型**：銅排厚度 vs 總負載
- **NFB 散熱間距**：NFB 排列太密影響散熱

---

*本文件最後更新：2026-02-12*
