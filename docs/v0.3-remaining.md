# v0.3 剩餘功能

> 擷取自 `project-rewire-roadmap.md`，FR-A / FR-D 已完成。
> 以下兩項功能規模較大、彼此高度相關，需拆分多個 change 逐步實作。

## 完成狀態

| 代號 | 功能 | 狀態 |
|------|------|------|
| FR-A | 拖拉接線 | ✓ 已完成 |
| FR-D | NFB 撥桿互動 | ✓ 已完成 |
| FR-B | 多迴路 / 多 NFB | 待實作 |
| FR-C | 110V / 220V 電壓區分 | 待實作（依賴 FR-B） |

---

## FR-B：多迴路 / 多 NFB

### 背景

v0.2 只有單一迴路（1 個 NFB + 1 條線 + 1 組插座），策略空間有限。

### 新增行為

- 配電箱中可安裝多個 NFB（DIN 軌道上排列）
- 每個 NFB 獨立接線到不同插座群組
- 玩家需決定哪些電器分配到哪個迴路
- 單一迴路過載只跳該迴路的 NFB，不影響其他迴路
- 新增關卡利用多迴路場景（如：廚房專用迴路 + 客廳迴路）

### 設計參考

> 「每關給一張 house load table，列出各房間的電器與瓦數。玩家要決定怎麼分迴路。」

### 影響範圍（預估）

- **型別系統**：Circuit 從單一變為陣列，SimulationState 需支援多迴路各自獨立的 wireHeat / breakerTripTimer / status
- **模擬引擎**：step() 需迭代多個迴路，各迴路獨立判定跳脫/燒毀
- **關卡定義**：Level 需定義迴路數量與 NFB 配置
- **SVG 電路圖**：從單迴路佈局改為多迴路並列，每個迴路有自己的 NFB 撥桿 + 線材 + 插座
- **拖曳接線**：需指定「這條線接到哪個迴路」
- **電器面板**：電器需分配到特定迴路，而非全部共用

---

## FR-C：110V / 220V 電壓區分

### 背景

目前 220V 電器只是用不同的 V 值計算電流，遊戲畫面與過程中 110V 和 220V 完全沒有差異，玩家感受不到電壓的意義。

### 現況問題

- 烘衣機 2200W/220V = 10A，看起來跟吹風機 1200W/110V = 10.9A 差不多
- 沒有專用迴路概念，220V 電器跟 110V 共用同一條線、同一個 NFB
- 電路圖上看不出 110V 和 220V 的差別

### 改善方向（隨多迴路一起實現）

- 220V 電器需接到 220V 專用迴路（紅-黑跨相），不能與 110V 共用
- 電路圖上 220V 迴路用雙線（紅+黑）表示，110V 用單線（紅或黑+白）
- 220V 插座外觀與 110V 不同（T 型 vs 一般）
- NFB 類型區分：110V 用 1P NFB，220V 用 2P NFB
- 若 220V 電器誤接 110V 迴路 → 功率不足、電器無法正常運作（新失敗類型）

### 備註

此功能與 FR-B 多迴路高度相關。在多迴路之前可先做視覺區分（如電器卡片、電路圖上標示不同顏色），但要真正有意義需要多迴路支撐。

---

## 建議實作順序

FR-B 和 FR-C 規模大，建議拆分成多個 change 逐步推進：

1. **multi-circuit-types** — 型別系統重構（Circuit[]、多迴路 SimulationState）
2. **multi-circuit-engine** — 模擬引擎支援多迴路獨立運算
3. **multi-circuit-ui** — SVG 多迴路佈局 + 電器分配 UI
4. **multi-circuit-levels** — 新增多迴路關卡（L06+）
5. **voltage-distinction** — 110V / 220V 視覺區分 + 專用迴路規則（FR-C）

以上順序僅為建議，實作時可依需求調整。
