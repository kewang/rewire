import type { Level } from '../types/game';
import { DEFAULT_APPLIANCES, DEFAULT_WIRES, BREAKER_15A, BREAKER_30A, DEFAULT_BREAKER } from './constants';

const [hairDryer, kettle, microwave, underSinkHeater, dryer, waterHeater, ihStove, airCon, bathHeater, fridge] = DEFAULT_APPLIANCES;
const [wire16, wire20] = DEFAULT_WIRES;

/** 關卡定義（L01-L05 單迴路, L06-L09 多迴路） */
export const LEVELS: readonly Level[] = [
  {
    name: 'L01 基礎教學',
    description: '接上吹風機並成功送電。理解 P ÷ V = I。',
    requiredAppliances: [hairDryer],
    budget: 50,
    survivalTime: 5,
    bonusCondition: { type: 'no-warning' },
    circuitConfigs: [
      { id: 'c1', label: '主迴路', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer] },
    ],
  },
  {
    name: 'L02 燒線陷阱',
    description: '同時使用吹風機和快煮壺。小心選線！',
    requiredAppliances: [hairDryer, kettle],
    budget: 120,
    survivalTime: 5,
    bonusCondition: { type: 'no-warning' },
    circuitConfigs: [
      { id: 'c1', label: '主迴路', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer, kettle] },
    ],
  },
  {
    name: 'L03 成本取捨',
    description: '同樣的電器，但預算收緊。不能無腦選最粗線。',
    requiredAppliances: [hairDryer, kettle],
    budget: 55,
    survivalTime: 5,
    bonusCondition: { type: 'no-warning' },
    circuitConfigs: [
      { id: 'c1', label: '主迴路', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer, kettle] },
    ],
  },
  {
    name: 'L04 低功率陷阱',
    description: '廚下加熱器才 800W，看起來很無害？加上快煮壺撐 8 秒試試。',
    requiredAppliances: [underSinkHeater, kettle],
    budget: 85,
    survivalTime: 8,
    bonusCondition: { type: 'no-warning' },
    circuitConfigs: [
      { id: 'c1', label: '主迴路', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [underSinkHeater, kettle] },
    ],
  },
  {
    name: 'L05 長時間耐久',
    description: '烘衣機 + 快煮壺，合計 23.6A。2.0mm² 撐得過 15 秒嗎？',
    requiredAppliances: [dryer, kettle],
    budget: 85,
    survivalTime: 15,
    bonusCondition: { type: 'no-warning' },
    circuitConfigs: [
      { id: 'c1', label: '主迴路', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [dryer, kettle] },
    ],
  },
  {
    name: 'L06 雙迴路入門',
    description: '廚房和客廳各有一條迴路。第一次體驗分迴路策略！',
    requiredAppliances: [kettle, microwave, hairDryer],
    budget: 120,
    survivalTime: 8,
    bonusCondition: { type: 'under-budget-ratio', ratio: 0.8 },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave] },
      { id: 'c2', label: '客廳', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer] },
    ],
  },
  {
    name: 'L07 預算壓力',
    description: '三條迴路但預算吃緊。最安全的線材買不起，你敢冒險嗎？',
    requiredAppliances: [kettle, underSinkHeater, hairDryer, dryer],
    budget: 130,
    survivalTime: 10,
    bonusCondition: { type: 'under-budget-ratio', ratio: 0.8 },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, underSinkHeater] },
      { id: 'c2', label: '臥室', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer] },
      { id: 'c3', label: '洗衣間', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [dryer] },
    ],
  },
  {
    name: 'L08 負載均衡',
    description: '五台電器、三條迴路。220V 專用迴路登場！合理分配比選粗線更重要。',
    requiredAppliances: [kettle, microwave, underSinkHeater, hairDryer, dryer],
    budget: 180,
    survivalTime: 15,
    bonusCondition: { type: 'under-budget-ratio', ratio: 0.8 },
    circuitConfigs: [
      { id: 'c1', label: '廚房A', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave, underSinkHeater, hairDryer] },
      { id: 'c2', label: '廚房B', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave, underSinkHeater, hairDryer] },
      { id: 'c3', label: '洗衣間', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [dryer] },
    ],
  },
  {
    name: 'L09 220V 的陷阱',
    description: '電熱水器 4400W 看起來是 220V 很安全？算算電流再說。',
    requiredAppliances: [kettle, underSinkHeater, waterHeater, dryer],
    budget: 130,
    survivalTime: 10,
    bonusCondition: { type: 'under-budget-ratio', ratio: 0.8 },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, underSinkHeater] },
      { id: 'c2', label: '浴室', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [waterHeater] },
      { id: 'c3', label: '洗衣間', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [dryer] },
    ],
  },
  {
    name: 'L10 新電器暖身',
    description: 'IH 爐需要 220V 專用迴路。冰箱和微波爐走廚房 110V。認識新電器！',
    requiredAppliances: [ihStove, fridge, microwave],
    budget: 150,
    survivalTime: 10,
    bonusCondition: { type: 'under-budget-ratio', ratio: 0.8 },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [fridge, microwave] },
      { id: 'c2', label: 'IH 爐', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [ihStove] },
    ],
  },
  {
    name: 'L11 相位平衡入門',
    description: '單相三線制登場！紅相和黑相要均衡分配，否則中性線會過載燒毀。',
    requiredAppliances: [kettle, hairDryer, fridge, airCon],
    budget: 200,
    survivalTime: 12,
    phaseMode: 'auto',
    bonusCondition: { type: 'time-margin', margin: 3 },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, fridge], phase: 'R' },
      { id: 'c2', label: '客廳', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer, fridge], phase: 'T' },
      { id: 'c3', label: '冷氣', voltage: 220, breaker: BREAKER_30A, availableAppliances: [airCon] },
    ],
  },
  {
    name: 'L12 相位平衡進階',
    description: '四條迴路，兩條都在紅相！你可以手動切換相位來平衡負載。',
    requiredAppliances: [kettle, microwave, hairDryer, underSinkHeater, fridge, airCon],
    budget: 250,
    survivalTime: 15,
    phaseMode: 'manual',
    bonusCondition: { type: 'time-margin', margin: 3 },
    circuitConfigs: [
      { id: 'c1', label: '廚房A', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave, underSinkHeater], phase: 'R' },
      { id: 'c2', label: '廚房B', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [microwave, underSinkHeater, hairDryer], phase: 'R' },
      { id: 'c3', label: '客廳', voltage: 110, breaker: BREAKER_15A, availableAppliances: [hairDryer, fridge], phase: 'T' },
      { id: 'c4', label: '冷氣', voltage: 220, breaker: BREAKER_30A, availableAppliances: [airCon] },
    ],
  },
  {
    name: 'L13 ELCB 入門',
    description: '浴室迴路必須安裝 ELCB 漏電斷路器。第 5 秒會發生漏電 — ELCB 會保護你！',
    requiredAppliances: [hairDryer],
    budget: 200,
    survivalTime: 10,
    leakageMode: 'scripted',
    bonusCondition: { type: 'no-trip' },
    leakageEvents: [{ time: 5, circuitId: 'c1' }],
    circuitConfigs: [
      { id: 'c1', label: '浴室', voltage: 220, breaker: BREAKER_30A, availableAppliances: [bathHeater, waterHeater], wetArea: true, elcbAvailable: true },
      { id: 'c2', label: '臥室', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer] },
    ],
  },
  {
    name: 'L14 ELCB 預算壓力',
    description: '浴室 ELCB 必裝，壓縮線材預算。廚房高負載能撐住嗎？',
    requiredAppliances: [kettle, microwave, fridge],
    budget: 185,
    survivalTime: 12,
    leakageMode: 'random',
    bonusCondition: { type: 'no-trip' },
    circuitConfigs: [
      { id: 'c1', label: '浴室', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [bathHeater], wetArea: true, elcbAvailable: true },
      { id: 'c2', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave, fridge] },
      { id: 'c3', label: '儲藏室', voltage: 110, breaker: BREAKER_15A, availableAppliances: [fridge] },
    ],
  },
  {
    name: 'L15 綜合挑戰',
    description: 'v0.4 畢業考！相位平衡 + ELCB + 多迴路預算。全部考驗一次來！',
    requiredAppliances: [kettle, microwave, hairDryer, ihStove, fridge],
    budget: 300,
    survivalTime: 20,
    phaseMode: 'manual',
    leakageMode: 'random',
    bonusCondition: { type: 'no-trip' },
    circuitConfigs: [
      { id: 'c1', label: '廚房A', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave, fridge], phase: 'R' },
      { id: 'c2', label: '廚房B', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [microwave, hairDryer, fridge], phase: 'R' },
      { id: 'c3', label: '浴室', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [bathHeater], wetArea: true, elcbAvailable: true },
      { id: 'c4', label: 'IH 爐', voltage: 220, breaker: BREAKER_30A, availableAppliances: [ihStove] },
    ],
  },
  {
    name: 'L16 壓接端子入門',
    description: '首次體驗壓接端子！接好線後要壓接才能送電。這關壓接品質不影響安全。',
    requiredAppliances: [hairDryer, fridge],
    budget: 80,
    survivalTime: 8,
    requiresCrimp: true,
    bonusCondition: { type: 'crimp-quality', minQuality: 'good' },
    circuitConfigs: [
      { id: 'c1', label: '客廳', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer, fridge] },
    ],
  },
  {
    name: 'L17 端子品質大考驗',
    description: '壓接品質差的話，接觸電阻會讓線材加速過熱！廚房迴路 23.6A，good 以上才安全。',
    requiredAppliances: [kettle, microwave, ihStove],
    budget: 180,
    survivalTime: 12,
    requiresCrimp: true,
    bonusCondition: { type: 'crimp-quality', minQuality: 'good' },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave] },
      { id: 'c2', label: 'IH 爐', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [ihStove] },
    ],
  },
  {
    name: 'L18 老屋驚魂：初診',
    description: '打開老配電箱，c1 活線沒壓端子！拆掉問題線路重新接線再送電。',
    requiredAppliances: [hairDryer, fridge, fridge],
    budget: 100,
    survivalTime: 10,
    requiresCrimp: true,
    bonusCondition: { type: 'no-warning' },
    circuitConfigs: [
      { id: 'c1', label: '客廳', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer, fridge] },
      { id: 'c2', label: '臥室', voltage: 110, breaker: BREAKER_15A, availableAppliances: [fridge] },
    ],
    oldHouse: {
      problems: [{ circuitId: 'c1', type: 'bare-wire' }],
      preWiredCircuits: {
        c1: { wire: wire20, crimpQuality: 'none', appliances: [hairDryer, fridge] },
        c2: { wire: wire16, crimpQuality: 'excellent', appliances: [fridge] },
      },
    },
  },
  {
    name: 'L19 老屋驚魂：全面檢修',
    description: '廚房線太細、客廳沒壓端子。兩條問題迴路等你修復！',
    requiredAppliances: [kettle, microwave, hairDryer],
    budget: 180,
    survivalTime: 12,
    requiresCrimp: true,
    bonusCondition: { type: 'no-warning' },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave] },
      { id: 'c2', label: '客廳', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer] },
      { id: 'c3', label: '儲藏室', voltage: 110, breaker: BREAKER_15A, availableAppliances: [microwave] },
    ],
    oldHouse: {
      problems: [
        { circuitId: 'c1', type: 'wrong-wire-gauge' },
        { circuitId: 'c2', type: 'bare-wire' },
      ],
      preWiredCircuits: {
        c1: { wire: wire16, crimpQuality: 'poor', appliances: [kettle, microwave] },
        c2: { wire: wire20, crimpQuality: 'none', appliances: [hairDryer] },
        c3: { wire: wire16, crimpQuality: 'good', appliances: [] },
      },
    },
  },
  {
    name: 'L20 老屋驚魂：危機四伏',
    description: 'v0.5 畢業考！氧化接點、裸線、線太細 — 三個問題加上潮濕浴室和相位平衡。',
    requiredAppliances: [kettle, hairDryer, fridge],
    budget: 250,
    survivalTime: 15,
    requiresCrimp: true,
    phaseMode: 'manual',
    leakageMode: 'random',
    bonusCondition: { type: 'no-warning' },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, fridge], phase: 'R' },
      { id: 'c2', label: '客廳', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer, fridge], phase: 'R' },
      { id: 'c3', label: '浴室', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [bathHeater], wetArea: true, elcbAvailable: true },
    ],
    oldHouse: {
      problems: [
        { circuitId: 'c1', type: 'oxidized-splice' },
        { circuitId: 'c2', type: 'bare-wire' },
        { circuitId: 'c3', type: 'wrong-wire-gauge' },
      ],
      preWiredCircuits: {
        c1: { wire: wire20, crimpQuality: 'none', appliances: [kettle] },
        c2: { wire: wire16, crimpQuality: 'none', appliances: [hairDryer] },
        c3: { wire: wire16, crimpQuality: 'poor', appliances: [bathHeater] },
      },
    },
  },
  {
    name: 'L21 整線入門',
    description: '首次體驗整線！3 迴路配電箱，學習車道排列和束帶放置。',
    requiredAppliances: [hairDryer, fridge, underSinkHeater],
    budget: 150,
    survivalTime: 10,
    requiresCrimp: true,
    requiresRouting: true,
    phaseMode: 'auto',
    bonusCondition: { type: 'aesthetics-score', minScore: 90 },
    circuitConfigs: [
      { id: 'c1', label: '客廳', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer], phase: 'R' },
      { id: 'c2', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [underSinkHeater], phase: 'T' },
      { id: 'c3', label: '儲藏室', voltage: 110, breaker: BREAKER_15A, availableAppliances: [fridge], phase: 'R' },
    ],
  },
  {
    name: 'L22 交叉迷宮',
    description: '5 迴路 + 混合電壓 + 手動相位。相位分配與走線排列互相影響！',
    requiredAppliances: [kettle, microwave, hairDryer, fridge, dryer],
    budget: 300,
    survivalTime: 12,
    requiresCrimp: true,
    requiresRouting: true,
    phaseMode: 'manual',
    bonusCondition: { type: 'aesthetics-score', minScore: 80 },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave], phase: 'R' },
      { id: 'c2', label: '客廳', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer], phase: 'T' },
      { id: 'c3', label: '儲藏室', voltage: 110, breaker: BREAKER_15A, availableAppliances: [fridge], phase: 'R' },
      { id: 'c4', label: '陽台', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [dryer] },
      { id: 'c5', label: '備用', voltage: 110, breaker: BREAKER_15A, availableAppliances: [fridge], phase: 'T' },
    ],
  },
  {
    name: 'L23 完美配電箱',
    description: 'v0.6 畢業考！6 迴路 + 混合電壓 + 相位 + ELCB + 壓接 + 整線，全機制綜合。',
    requiredAppliances: [kettle, microwave, hairDryer, fridge, airCon, bathHeater],
    budget: 400,
    survivalTime: 15,
    requiresCrimp: true,
    requiresRouting: true,
    phaseMode: 'manual',
    leakageMode: 'random',
    bonusCondition: { type: 'aesthetics-score', minScore: 70 },
    circuitConfigs: [
      { id: 'c1', label: '廚房', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [kettle, microwave], phase: 'R' },
      { id: 'c2', label: '客廳', voltage: 110, breaker: DEFAULT_BREAKER, availableAppliances: [hairDryer], phase: 'R' },
      { id: 'c3', label: '儲藏室', voltage: 110, breaker: BREAKER_15A, availableAppliances: [fridge], phase: 'T' },
      { id: 'c4', label: '客廳冷氣', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [airCon] },
      { id: 'c5', label: '浴室', voltage: 220, breaker: DEFAULT_BREAKER, availableAppliances: [bathHeater], wetArea: true, elcbAvailable: true },
      { id: 'c6', label: '備用', voltage: 110, breaker: BREAKER_15A, availableAppliances: [fridge], phase: 'T' },
    ],
  },
] as const;
