## Context

v0.3 FR-B 的型別系統（multi-circuit-types）、模擬引擎（multi-circuit-engine）、UI（multi-circuit-ui）三個 change 已完成。所有基礎設施已就緒：

- `Level.circuitConfigs` 支援多個 `CircuitConfig`
- `stepMulti()` 迭代各迴路獨立模擬
- `CircuitDiagram` 可水平並列渲染多迴路
- `AppliancePanel` 有 circuit-tabs 供電器分配
- `WiringState` 支援 per-circuit 接線

目前 L01-L05 全部是單迴路（circuitConfigs 只有一個元素），玩家無法體驗多迴路策略。

### 電器電流速查

| 電器 | 功率 | 電壓 | 電流 |
|------|------|------|------|
| 吹風機 | 1200W | 110V | 10.9A |
| 快煮壺 | 1500W | 110V | 13.6A |
| 微波爐 | 1100W | 110V | 10.0A |
| 廚下加熱器 | 800W | 110V | 7.3A |
| 烘衣機 | 2200W | 220V | 10.0A |

### NFB 跳脫門檻

| NFB 額定 | 跳脫門檻 (×1.25) |
|----------|------------------|
| 15A | 18.75A |
| 20A | 25.0A |
| 30A | 37.5A |

### 線材安全電流

| 線徑 | maxCurrent | 成本/m | 10m 成本 |
|------|-----------|--------|---------|
| 1.6mm² | 15A | $3 | $30 |
| 2.0mm² | 20A | $5 | $50 |
| 3.5mm² | 25A | $8 | $80 |
| 5.5mm² | 30A | $12 | $120 |
| 8.0mm² | 45A | $18 | $180 |

## Goals / Non-Goals

**Goals:**
- 新增 3 個多迴路關卡（L06-L08），難度遞增
- 讓玩家體驗「分配電器到不同迴路」的策略決策
- 教學漸進：2 迴路 → 3 迴路，簡單 → 預算壓力 → 高負載耐久
- 每關有明確的「錯誤策略 → 失敗」和「正確策略 → 通關」路徑

**Non-Goals:**
- 不新增電器或線材種類（留給 voltage-distinction）
- 不修改模擬引擎或 UI 元件
- 不引入 per-circuit NFB 獨立開關（目前仍為全域送電）
- 不處理 110V/220V 專用迴路規則（FR-C 範疇）

## Decisions

### D1: 關卡數量與遞進設計

**決定**: 新增 3 個關卡（L06-L08），而非 2 個或 5 個。

**理由**: 3 個關卡能涵蓋「雙迴路入門 → 三迴路預算 → 三迴路耐久」的完整難度曲線，又不至於在 voltage-distinction 之前就消耗太多關卡空間。

### D2: L06 — 雙迴路入門（廚房 + 客廳）

**場景**: 廚房有快煮壺+微波爐，客廳有吹風機。玩家第一次體驗分迴路。

**配置**:
- 迴路 c1「廚房」: 20A NFB, 可用電器 = [快煮壺, 微波爐]
- 迴路 c2「客廳」: 20A NFB, 可用電器 = [吹風機]
- requiredAppliances = [快煮壺, 微波爐, 吹風機]
- 預算 = $120, survivalTime = 8s

**分析**:
- c1 廚房: 13.6 + 10.0 = 23.6A → 超 20A 線材上限但未超 25A 跳脫門檻 → 需 3.5mm²($80) 或更粗
- c2 客廳: 10.9A → 1.6mm²($30) 即可
- 最低成本: $80 + $30 = $110, 預算 $120 足夠
- 陷阱: 若兩條都用 2.0mm², 成本 $100 但 c1 會過載燒毀

### D3: L07 — 三迴路預算壓力

**場景**: 三個迴路各有不同電器，預算緊縮迫使精準選線。

**配置**:
- 迴路 c1「廚房」: 20A NFB, 可用電器 = [快煮壺, 廚下加熱器]
- 迴路 c2「臥室」: 20A NFB, 可用電器 = [吹風機]
- 迴路 c3「洗衣間」: 20A NFB, 可用電器 = [烘衣機]
- requiredAppliances = [快煮壺, 廚下加熱器, 吹風機, 烘衣機]
- 預算 = $130, survivalTime = 10s

**分析**:
- c1 廚房: 13.6 + 7.3 = 20.9A → 超 20A 線材微幅過載 → 2.0mm² 會慢慢過熱，10s 內勉強但危險 → 安全需 3.5mm²($80)
- c2 臥室: 10.9A → 1.6mm²($30) 即可
- c3 洗衣間: 10.0A → 1.6mm²($30) 即可
- 最低安全成本: $80 + $30 + $30 = $140 → 超預算！
- 策略: c1 用 2.0mm²($50), 可過但進入 warning; c2+c3 用 1.6mm²($30×2); 合計 $110 ✓
- 或: c1 用 3.5mm²($80), c2 用 1.6mm²($30), c3 用 1.6mm²($30); 合計 $140 → 超預算 ❌
- 正解: c1 用 2.0mm²($50) 是 20.9A vs 20A maxCurrent，過載比 = 0.045，heatRate=0.4，10s 累積熱度 = 0.045 × 0.4 × 10 = 0.18 → 安全通關

### D4: L08 — 三迴路高負載耐久

**場景**: 三條迴路都有高負載電器，15 秒耐久考驗。需要精準的電器分配和線徑選擇。

**配置**:
- 迴路 c1「廚房A」: 20A NFB, 可用電器 = [快煮壺, 微波爐, 廚下加熱器]
- 迴路 c2「廚房B」: 20A NFB, 可用電器 = [快煮壺, 微波爐, 廚下加熱器]
- 迴路 c3「客廳」: 20A NFB, 可用電器 = [吹風機, 烘衣機]
- requiredAppliances = [快煮壺, 微波爐, 廚下加熱器, 吹風機, 烘衣機]
- 預算 = $180, survivalTime = 15s

**分析**:
- 5 個電器分到 3 迴路，但 c1/c2 共享電器池 → 玩家需決定哪些電器放哪個迴路
- 策略範例: c1=[快煮壺, 廚下加熱器](20.9A), c2=[微波爐](10.0A), c3=[吹風機, 烘衣機](20.9A)
  - c1: 2.0mm²($50), c2: 1.6mm²($30), c3: 2.0mm²($50) → $130 ✓
- 不良分配: c1=[快煮壺, 微波爐](23.6A), c2=[廚下加熱器](7.3A), c3=[吹風機, 烘衣機](20.9A)
  - c1: 23.6A 超 20A maxCurrent, overloadRatio=0.18, 15s 熱度=0.18×0.4×15=1.08 → 燒毀！需 3.5mm²($80)
  - 合計 $80+$30+$50 = $160 也行但浪費預算
- 核心教學: 分配電器使各迴路負載均衡比選粗線更重要

### D5: 電器在多迴路間的共享設計

**決定**: L08 使用 `availableAppliances` 重疊的方式讓 c1/c2 共享電器池。

**理由**: 現有 `CircuitConfig.availableAppliances` 已支援每迴路獨立定義可用電器。當兩迴路有重疊電器時，玩家在 AppliancePanel 分配電器到某迴路後，該電器會從其他迴路的可用清單中消失（GameBoard 已實作此邏輯）。無需新增程式碼。

### D6: NFB 額定值

**決定**: L06-L08 全部使用 20A NFB（DEFAULT_BREAKER），不引入新的 NFB 規格。

**理由**:
- 引入不同 NFB 額定增加認知負擔，但本 change 重點在「分迴路」而非「選 NFB」
- 20A NFB 跳脫門檻 25A，已足夠讓玩家體驗過載燒毀（而非跳脫）的場景
- 不同 NFB 規格可留給 voltage-distinction（2P NFB for 220V）

## Risks / Trade-offs

- **[數值平衡]** L07 的 2.0mm² 線材在 20.9A 下 10 秒的熱度累積 (0.18) 較低，warning 狀態不夠緊張 → **可接受**，作為入門多迴路關卡，適度的 warning 就能傳達訊息
- **[電器分配直覺]** L08 共享電器池的設計可能讓新手困惑 → **緩解**: 關卡描述中提示「合理分配電器到各迴路」
- **[單迴路回歸]** 新增關卡不應影響 L01-L05 → **低風險**，只是在 LEVELS 陣列追加元素
